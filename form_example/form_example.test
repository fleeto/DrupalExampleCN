<?php
// $Id$

/**
 * @file
 * test file for form_example module.
 */

/**
 * Default test case for the form_example module.
 */
class FormExampleTestCase extends DrupalWebTestCase {

  public static function getInfo() {
    return array(
      'name' => 'Form Example tests',
      'description' => 'Various tests on the dbtng example module.' ,
      'group' => 'Examples',
    );
  }

  function setUp() {
    parent::setUp('form_example');
  }

  /**
   * Test each tutorial
   */
  function testTutorials() {
    // Tutorial #1
    $this->drupalGet('examples/form_example/tutorial');
    $this->assertText(t('#9'));

    // #2
    $this->drupalPost('examples/form_example/tutorial/2', array('name' => t('name')), t('Submit'));

    // #4
    $this->drupalPost('examples/form_example/tutorial/4',
      array('first' => t('firstname'), 'last' => t('lastname')), t('Submit'));
    $this->drupalPost('examples/form_example/tutorial/4', array(), t('Submit'));
    $this->assertText(t('First name field is required'));
    $this->assertText(t('Last name field is required'));

    // #5
    $this->drupalPost('examples/form_example/tutorial/5',
      array('first' => t('firstname'), 'last' => t('lastname')), t('Submit'));
    $this->assertText(t('Please enter your first name'));
    $this->drupalPost('examples/form_example/tutorial/4', array(), t('Submit'));
    $this->assertText(t('First name field is required'));
    $this->assertText(t('Last name field is required'));

    // #6
    $this->drupalPost('examples/form_example/tutorial/6',
      array('first' => t('firstname'), 'last' => t('lastname'), 'year_of_birth' => 1955),
      t('Submit'));
    $this->assertNoText(t('Enter a year between 1900 and 2000'));
    $this->drupalPost('examples/form_example/tutorial/6',
      array('first' => t('firstname'), 'last' => t('lastname'), 'year_of_birth' => 1855),
      t('Submit'));

    $this->assertText(t('Enter a year between 1900 and 2000'));


    // #7
    $this->drupalPost('examples/form_example/tutorial/7',
      array('first' => t('firstname'), 'last' => t('lastname'), 'year_of_birth' => 1955),
      t('Submit'));
    $this->assertText(t('The form has been submitted. name="firstname lastname", year of birth=1955'));
    $this->drupalPost('examples/form_example/tutorial/7',
      array('first' => t('firstname'), 'last' => t('lastname'), 'year_of_birth' => 1855),
      t('Submit'));

    $this->assertText(t('Enter a year between 1900 and 2000'));

      // #8
    $this->drupalPost('examples/form_example/tutorial/8',
      array('first' => t('firstname'), 'last' => t('lastname'), 'year_of_birth' => 1955),
      t('Next >>'));

    $this->drupalPost(NULL, array('color' => t('green')), t('<< Back'));
    debug($this->content, 'Content after pressing back');
    $this->drupalPost(NULL, array(), t('Next >>'));
    debug($this->content, 'Content after pressing next');
    $this->drupalPost(NULL, array('color' => t('red')), t('Submit'));
    debug($this->content, 'Content after pressing submit');
    $this->assertText(t('The form has been submitted. name="firstname lastname", year of birth=1955'));
    $this->assertText(t('And the favorite color is red'));

    // #9
    $url = 'examples/form_example/tutorial/9';
    for ($i = 1; $i <= 4; $i++) {
      if ($i > 1) {
        $url = NULL;  // later steps of multistep form take NULL.
      }
      $this->drupalPost($url,
        array("name[$i][first]" => "firstname $i", "name[$i][last]" => "lastname $i", "name[$i][year_of_birth]" => 1950 + $i),
        t('Add another name'));
      $this->assertText(t('Name #@num', array('@num' => $i + 1)));
    }

    // Now remove the last name added (#5).
    $this->drupalPost(NULL, array(), t('Remove latest name'));
    $this->assertNoText("Name #5");

    $this->drupalPost(NULL, array(), t('Submit'));

    $this->assertText('Form 9 has been submitted');
    for ($i = 1; $i <= 4; $i++) {
      $this->assertText(t('@num: firstname @num lastname @num (@year)', array('@num' => $i, '@year' => 1950 + $i)));
    }
  }
}

